<!DOCTYPE html>
<html>
<head>
<title>Strict Mode和Extended Mode - JavaScript编程语言</title>
<meta charset="UTF-8">
<meta name="baidu-site-verification" content="LPyqUhB1p3" />
<meta name="viewport" content="width=device-width">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="JavaScript编程语言 - 一本开源的JavaScript编程指南; An open-sourced Javascript Guide and Tutorial; Strict Mode和Extended Mode  本文上一个版本盗用了别人的文章，经读者指出后我就删掉了。由于起草的时间在去年，我也不太清楚当初是怎么把别人的文章复制进来的。本文除了介绍所谓的Strict Mode之外，还会介绍其他关联内容。  JavaScript并不是一个完美的语言。事实上，第一个版本是Brendan Eich1花费十天的时间创造的，你不能对它期望太多。之后，JavaScr">
<meta name="keywords" content="Javascript, guide, open-sourced ">
<link rel="stylesheet" type="text/css" href="/style.css" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-313435-11', 'robinqu.me');
  ga('send', 'pageview');

</script>
</head>
<body>
<header class="clearfix">
  <div class="left back-toc">
    <ul class="inline-list">
      <li><a href="/">目录</a></li>
      
        <li class="seperator">></li>
        <li>JavaScript核心</li>
      
        <li class="seperator">></li>
        <li>JavaScript语法基础</li>
      
      
      <li class="seperator">></li>
      <li class="current"><strong>当前页面</strong></li>
      
      <li>(<a href="https://github.com/RobinQu/Programing-In-Javascript/edit/master/chapters/JavaScript_Core/JavaScript_Basics/Strict_Mode.md">编辑</a>)</li>
    </ul>
  </div>
  <div class="right">
    <a href="/"><img src="/images/logo.png" alt="Javascript编程语言" width="256" height="50" /></a>
  </div>
</header>
<div class="primary">
  <h1 id="strict-mode-extended-mode">Strict Mode和Extended Mode</h1>
<blockquote>
<p>本文上一个版本盗用了别人的文章，经读者指出后我就删掉了。由于起草的时间在去年，我也不太清楚当初是怎么把别人的文章复制进来的。本文除了介绍所谓的Strict Mode之外，还会介绍其他关联内容。</p>
</blockquote>
<p>JavaScript并不是一个完美的语言。事实上，第一个版本是Brendan Eich<sup id="fnref1"><a href="#fn1">1</a></sup>花费十天的时间创造的，你不能对它期望太多。之后，JavaScript在浏览器大战中，成为各方角逐的主要战场。各大厂商各显神通，其副作用是各种奇奇怪怪的行为和各式不一的API。在之后，W3C和其他社区团体花费了大量的精力来通过标准化来“净化”所有Web开发相关的技术标准。</p>
<p>但尴尬的是，浏览器厂商并不是那么完全的实现了W3C和ECMAScript的各种标准。最后，经验丰富的Javascript程序员，通过约束自身对Javascript的使用方法，来达到让Javascript更高的可拥度。可能大部分人都读过《JavaScript语言精粹》<sup id="fnref2"><a href="#fn2">2</a></sup>这本书，其讲述的就是如何在JavaScript语言中，取其精华，然后去其糟粕。</p>
<p>而JavaScript的严格模式，则是另一种紧箍咒，它的约束力来自运行时本身，而不是用户的主观行为。也就是说，有很多模棱两可，或是错误却被允许的操作，被彻底禁止了。目前支持严格模式的支持范围<sup id="fnref3"><a href="#fn3">3</a></sup>从IE10起跳，其他常青浏览器也都是支持的。</p>
<iframe src="http://caniuse.com/use-strict/embed/" seamless="" width="100%"></iframe>

<h2 id="-">如何开启</h2>
<p>开启全局模式只需在所有语句之前放置<code>&quot;use strict&quot;</code>字符串常量。</p>
<p>全局开启严格模式：</p>
<pre><code>&quot;use strict&quot;
var v = &quot;Hello world&quot;;
</code></pre><p>但注意，这样会导致整个脚本内的代码都在严格模式中执行。假如之前有些代码并没有考虑严格模式，这可能让你的整个应用程序突然失效。</p>
<p>我们更为推荐的是，在某个函数内开启严格模式：</p>
<pre><code>function mySuperMethod() {
    &quot;use strict&quot;;
    var v = &quot;Hello world&quot;;
}

function mySuckingMethod {
    //not in strict mode
}
</code></pre><h2 id="-">严格模式的具体行为</h2>
<p>大家有需要记住一堆语言特性了。但是，还好这些内容是把“歪”的掰“直”了。有少数代码例子来自于MDC<sup id="fnref4"><a href="#fn4">4</a></sup>。</p>
<h3 id="-referenceerror-">抛出<code>ReferenceError</code></h3>
<ol>
<li><p>试图隐式创建全局变量</p>
<pre><code> ```
 &quot;use strict&quot;
 hello = &quot;world&quot;//throw
 ```
</code></pre></li>
</ol>
<h3 id="-typeerror-">抛出<code>TypeError</code></h3>
<ol>
<li><p>试图修改已经被定义为不可写的属性</p>
<pre><code> ```
 &quot;use strict&quot;;
 var o = {};
 Object.defineProperty(o, &quot;hello&quot;, {value:&quot;world&quot;, writable:false});
 o.hello = &quot;bad boy&quot;;//throw
 ```
</code></pre><p> 其他类似的还有：</p>
<ul>
<li>给只读属性赋值</li>
<li>给不可扩展的对象新建属性        </li>
</ul>
</li>
<li><p>试图删除不可删除的属性</p>
<pre><code> ```
 &quot;use strict&quot;;
 delete Object.prototype; //throw
 ```
</code></pre></li>
<li><p><code>arguments.callee</code>不能被返回、删除、修改；</p>
<pre><code> ```
 &quot;use strict&quot;;
 var fun = function() { 
     return arugments.callee;//throw
 };
 ```
</code></pre></li>
</ol>
<h3 id="-syntaxerror-">抛出<code>SyntaxError</code></h3>
<ol>
<li><p>重复定义属性名</p>
<pre><code> ```
 &quot;use strict&quot;;
 var o = {hello: 1, hello: 2};//throw
 ```
</code></pre></li>
<li><p>禁用八进制字面量</p>
</li>
</ol>
<pre><code>    ```
    &quot;use strict&quot;;
    var hello = 015;//throw
    ```
</code></pre><ol>
<li><p>不允许重复参数名</p>
<pre><code> ```
 function myMethod(a, b, b) {//throw
     &quot;use strict&quot;;
 }
 ```
</code></pre></li>
<li><p>不能使用<code>with</code></p>
<pre><code> ```
 &quot;use strict&quot;;
 var obj = {};
 with (obj) {};//throw
 ```
</code></pre></li>
<li><p>不允许对<code>eval</code>或<code>arguments</code>赋值</p>
<pre><code> ```
 var fun = function(){
     &quot;use strict&quot;;
     eval=16
 }();
 ```
</code></pre></li>
<li><p>不可将<code>eval</code>或<code>arguments</code>作为参数名、变量名</p>
<pre><code> ```
 var fun = function(){
     &quot;use strict&quot;; 
     var obj = { 
         set p(arguments) {} 
     };
 }();
 ```
</code></pre></li>
</ol>
<h3 id="-eval-"><code>eval</code>被限制在临时的本地作用域</h3>
<p>eval不再有权限直接修改其所在作用于，而只能影响自身创建的作用域。</p>
<pre><code>var hello = &quot;world&quot;;
var evalHello = eval(&quot;&#39;use strict&#39;; var hello = &quot;girl&quot;; hello&quot;);
// hello === &quot;world&quot;
// evalHello === &quot;girl&quot;
</code></pre><h3 id="-arguments-"><code>arguments</code>不再追踪实际参数值变化</h3>
<pre><code>function f(hello) {
  &quot;use strict&quot;;
  hello = &quot;girl&quot;;
  return [hello, arguments[0]];
}
var pair = f(&quot;world&quot;);
// pair[0] === &quot;girl&quot;
// pair[1] === &quot;world&quot;;
</code></pre><h3 id="-this-">函数的动态绑定后的<code>this</code>不做任何修改</h3>
<ul>
<li>即使指定<code>null</code>或<code>undefined</code>，引擎也不会重新指定全局对象作为<code>this</code></li>
<li>指定基础数据类型时，也不会用包装类进行转换</li>
</ul>
<pre><code>&quot;use strict&quot;;
function fun() { return this; }
// fun() === undefined
// fun.call(2) === 2
// fun.apply(null) === null
// fun.call(undefined) === undefined
// fun.bind(true)() === true
</code></pre><h3 id="-">调用堆栈不可被追踪</h3>
<p>以往，我们可以通过函数的<code>caller</code>和<code>arguments</code>来投影整个调用堆栈。但是，在严格模式中我们做不到。</p>
<pre><code>function restricted() {
  &quot;use strict&quot;;
  restricted.caller;    // throws a TypeError
  restricted.arguments; // throws a TypeError
}
</code></pre><h3 id="ecmascript6-">ECMAScript6的相关特性</h3>
<h4 id="-">更多保留字</h4>
<pre><code>implements, interface, let, package, private, protected, public, static, yield
</code></pre><h4 id="-function-">仅允许在开头使用function语句</h4>
<p>很多开发者喜欢如下代码风格，这在严格模式中会报错。</p>
<pre><code>function foo() {
  &quot;use strict&quot;;
  return g;
  function g() { }//throw SyntaxError
}
</code></pre><p>这个改变的原因是，JavaScript的<code>Hoisting</code>特性会让很多人迷惑：</p>
<pre><code>function g() { }
function foo() {
    if (true)
    function g() { }
    return g;
}
</code></pre><h2 id="extended-mode">Extended Mode</h2>
<p>ES6 Draft中引入了一个新的概念<sup id="fnref5"><a href="#fn5">5</a></sup>，叫<code>Extend Mode</code>，然后又被撤销了<sup id="fnref6"><a href="#fn6">6</a></sup>。但不幸的是，V8中已经支持了这个新模式。所以，作为事实标准，目前依赖V8的所有Javascript运行环境都有如下三个模式：</p>
<ul>
<li>Classic Mode，或者Non-strict mode</li>
<li>Strict Mode</li>
<li>Extended Mode</li>
</ul>
<p>这个模式是备受争议的。这个模式的产生，也体会出制作一个标准的困难之处——你总要考虑新标准对老标准的兼容，尤其是Web技术。</p>
<p>有稍微了解ES6的同学都应该清楚，<code>module</code>、<code>class</code>这些东西已经完全颠覆了传统JavaScript的很多常识。但也有不少东西，开发者是可以接受，并立马去尝试的。于是乎，关于如何让代码部分进入<code>extended mode</code>也就成了最初讨论的重点<sup id="fnref7"><a href="#fn7">7</a></sup>。</p>
<p>实际表现上，node的0.11.x的版本，有些特性，仅仅使用<code>--harmony</code>并不能完全使用，还需加上<code>--use_strict</code>。在这里，已经可以看出V8团队有多纠结了<sup id="fnref8"><a href="#fn8">8</a></sup>。他们也没有想清楚，该如何进入<code>extended mode</code>，索性，也叫<code>strict</code>吧。</p>
<p>目前仅在<code>extended mode</code>下可用的ES6特性：</p>
<ul>
<li>let</li>
<li>blockl-level function declaration</li>
</ul>
<p>关于ES6的特性，请参考本书的相关章节。</p>
<hr>
<div class="footnotes">
<ol>
<li id="fn1"><p><a href="http://en.wikipedia.org/wiki/Brendan_Eich">http://en.wikipedia.org/wiki/Brendan_Eich</a></p>
<a href="#fnref1" class="footnoteBackLink" title="Jump back to footnote 1 in the text.">↩</a></li>
<li id="fn2"><p><a href="http://book.douban.com/subject/3590768/">http://book.douban.com/subject/3590768/</a></p>
<a href="#fnref2" class="footnoteBackLink" title="Jump back to footnote 2 in the text.">↩</a></li>
<li id="fn3"><p><a href="http://caniuse.com/#feat=use-strict">http://caniuse.com/#feat=use-strict</a></p>
<a href="#fnref3" class="footnoteBackLink" title="Jump back to footnote 3 in the text.">↩</a></li>
<li id="fn4"><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Strict_mode">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Strict_mode</a></p>
<a href="#fnref4" class="footnoteBackLink" title="Jump back to footnote 4 in the text.">↩</a></li>
<li id="fn5"><p><a href="http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts">http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts</a></p>
<a href="#fnref5" class="footnoteBackLink" title="Jump back to footnote 5 in the text.">↩</a></li>
<li id="fn6"><p><a href="http://wiki.ecmascript.org/lib/exe/fetch.php?id=harmony%3Aspecification_drafts&amp;cache=cache&amp;media=harmony:working_draft_ecma-262_edition_6_11-7-11.pdf">http://wiki.ecmascript.org/lib/exe/fetch.php?id=harmony%3Aspecification_drafts&amp;cache=cache&amp;media=harmony:working_draft_ecma-262_edition_6_11-7-11.pdf</a></p>
<a href="#fnref6" class="footnoteBackLink" title="Jump back to footnote 6 in the text.">↩</a></li>
<li id="fn7"><p><a href="https://lists.webkit.org/pipermail/webkit-dev/2011-December/018903.html">https://lists.webkit.org/pipermail/webkit-dev/2011-December/018903.html</a></p>
<a href="#fnref7" class="footnoteBackLink" title="Jump back to footnote 7 in the text.">↩</a></li>
<li id="fn8"><p><a href="https://code.google.com/p/v8/source/detail?r=10062">https://code.google.com/p/v8/source/detail?r=10062</a></p>
<a href="#fnref8" class="footnoteBackLink" title="Jump back to footnote 8 in the text.">↩</a></li>
</ol>
</div>

</div>
<footer class="misc clearfix">
  <p class="hint">建议在新版的Chrome、Safari、Firefox中阅读</p>
  <div class="left">
    <ul class="inline-list">
      <li><a href="https://github.com/RobinQu/Programing-In-Javascript/">Source</a></li>
      <li><a href="https://github.com/RobinQu/Programing-In-Javascript/blob/master/README.md">Contributors</a></li>
      <li><a href="https://github.com/RobinQu/Programing-In-Javascript/issues">Issues</a></li>
    </ul>
  </div>
  <div class="right">
    <ul class="inline-list">
      <li>Rev <a href="https://github.com/RobinQu/Programing-In-Javascript/tree/cd05d3d/chapters/JavaScript_Core/JavaScript_Basics/Strict_Mode.md">cd05d3d</a></li>
      <li>2014-05-29T06:40:37.982Z</li>
    </ul>
  </div>
</footer>
</body>
</html>